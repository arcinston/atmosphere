From ddaf5e662d02df9f1bce203216304cd78878eb90 Mon Sep 17 00:00:00 2001
From: ricolin <rlin@vexxhost.com>
Date: Wed, 7 May 2025 14:20:26 +0800
Subject: [PATCH 1/3] Enable {priority,runtime}ClassName for bootstrap job

Change-Id: I86cc6fefc0c24d43e1b8ec57743509e9e8032778
---
 helm-toolkit/templates/manifests/_job-bootstrap.tpl   |  6 ++++++
 releasenotes/notes/helm-toolkit-6cd5aa637e3a4516.yaml | 10 ++++++++++
 2 files changed, 16 insertions(+)
 create mode 100644 releasenotes/notes/helm-toolkit-6cd5aa637e3a4516.yaml

diff --git a/helm-toolkit/templates/manifests/_job-bootstrap.tpl b/helm-toolkit/templates/manifests/_job-bootstrap.tpl
index cefd4e859..cd6ab3a2f 100644
--- a/helm-toolkit/templates/manifests/_job-bootstrap.tpl
+++ b/helm-toolkit/templates/manifests/_job-bootstrap.tpl
@@ -71,6 +71,12 @@ spec:
       annotations:
 {{ tuple $envAll | include "helm-toolkit.snippets.release_uuid" | indent 8 }}
     spec:
+{{- if and $envAll.Values.pod.priorityClassName $envAll.Values.pod.priorityClassName.bootstrap }}
+      priorityClassName: {{ $envAll.Values.pod.priorityClassName.bootstrap }}
+{{- end }}
+{{- if and $envAll.Values.pod.runtimeClassName $envAll.Values.pod.runtimeClassName.bootstrap }}
+      runtimeClassName: {{ $envAll.Values.pod.runtimeClassName.bootstrap }}
+{{- end }}
       serviceAccountName: {{ $serviceAccountName }}
       restartPolicy: OnFailure
       {{ tuple $envAll "bootstrap" | include "helm-toolkit.snippets.kubernetes_image_pull_secrets" | indent 6 }}
diff --git a/releasenotes/notes/helm-toolkit-6cd5aa637e3a4516.yaml b/releasenotes/notes/helm-toolkit-6cd5aa637e3a4516.yaml
new file mode 100644
index 000000000..730ac397e
--- /dev/null
+++ b/releasenotes/notes/helm-toolkit-6cd5aa637e3a4516.yaml
@@ -0,0 +1,10 @@
+---
+helm-toolkit:
+  - |
+    Add support for {priority,runtime}ClassName for bootstrap job in helm-toolkit.
+features:
+  - |
+    Add {priority,runtime}ClassName for bootstrap job in helm-toolkit.
+    This provides a balance of performance versus security.
+    So as better prioritize between pods.
+...
-- 
2.25.1

